<html>
    <body>
    <h1>Test Test</h1>
    <p id="demo"></p>
    
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
    <script>
   
    var text, parser, xmlDoc;



    function xml_to_div(str) {
        return String(str).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
    }
        
    function create_div(xml) {
        const resitems = xml.getElementsByTagName("resource").length;
        for (let i = 0; i<resitems; i++) {
            const div = document.createElement("DIV");
            div.innerHTML = xml.querySelectorAll("resource")[i].getAttribute("name")
            document.querySelector("#demo").appendChild(div)

            var child = xml.querySelectorAll("resource")[i].querySelectorAll("resprofile")
            var profitems = child.length
            for (let i = 0; i < profitems; i++) {
                const div = document.createElement("DIV");
                div.innerHTML = child[i].getAttribute("name")
                document.querySelector("#demo").appendChild(div)

                if (i == profitems -1){
                                        // Create an input element for Name
                    var FN = document.createElement("input");
                    FN.setAttribute("type", "text");
                    FN.setAttribute("name", "Name");
                    FN.setAttribute("placeholder", "Name");
                    
                    // Create an input element for Full Name
                    var Role = document.createElement("input");
                    Role.setAttribute("type", "text");
                    Role.setAttribute("name", "role");
                    Role.setAttribute("placeholder", "role");

                    // Create an input element for Full Name
                    var Task = document.createElement("input");
                    Task.setAttribute("type", "text");
                    Task.setAttribute("name", "task");
                    Task.setAttribute("placeholder", "task");

                    // create a submit button
                    var s = document.createElement("input");
                    s.setAttribute("type", "submit");
                    

                    console.log("create Form now")
                    const form = document.createElement("form");
                    form.setAttribute("name", "myform")
                    form.setAttribute("id", "myform")
                    //form.setAttribute("onsubmit", "return add_data()" )
                    form.setAttribute("method", "POST");
                    form.setAttribute("action", "http://localhost:8000/edit/add_resprofile/")
                    form.setAttribute("return", "false")

                    form.appendChild(FN)
                    form.appendChild(Role)
                    form.appendChild(Task)
                    form.appendChild(s)

                    document.querySelector("#demo").appendChild(form)   

        $(document).ready(function() {
            $('#myform').submit(function (e) { 
                e.preventDefault();
                console.log("Ajax called");
                var formdata = JSON.stringify($(this).serializeArray());
                console.log(formdata)
                    $.ajax({
                        url: "http://localhost:8000/edit/add_resprofile/",
                        method: $(this).attr("method"),
                        type: "POST",
                        data: formdata,
                        success: function(){},
                        dataType: "json",
                        contentType : "application/json"
                        });
                    return false;
                    });
                });

                }
            }
        }
    }


    fetch("http://localhost:8000/resources")
        .then (function (response){
            return response.text();
        })
        .then(function (data) {
            console.log (data);
        
        parser = new DOMParser (),
            xmlDoc = parser.parseFromString (data, 'text/xml');
        
        console.log(xmlDoc.getElementsByTagName('resource'))
        create_div(xmlDoc)
        })

    //xmlDoc = parser.parseFromString(text,"text/xml");
    //console.log(text)
    //create_div(text)
    
    //document.getElementById("demo").innerHTML =
    //text.getElementsByTagName("resource")[0].childNodes[0].nodeValue;
    </script>
    
    </body>
    </html> 